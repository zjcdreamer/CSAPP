### 位和上下文
1. 源程序实际上就是由0、1组成的位序列。1字节=8位
2. 只由ASCII字符组成的是文本文件，其他的是二进制文件
3. 字、字节、比特、位的关系：1字=2字节=16位=16比特

### 程序的存储和执行：
GCC编译器驱动程序读取源文件hello.c，并把他翻译成一个可执行的hello目标文件。这个过程分为四个阶段：![image-20200507120612716](D:\markdown的笔记\Typora\images\image-20200507120612716.png)

预处理器 --> 编译器 --> 汇编器 --> 链接器

- 预处理阶段：预处理器根据#开头的语句，读取系统的头文件，然后插入到程序文本中。hello.c被修改为hello.i
- 编译器：编译器把被修改后的程序文本翻译成汇编语言，此时hello.i变成hello.s。虽然不同的语言不同的编译器，但是他们的输出文件用的汇编语言都是一样的。
- 汇编阶段：汇编器将汇编语言翻译成一条一条的机器语言指令，把这些指令打包成一种叫做可重定位目标程序，将结果保存到hello.o文件中。hello.o文件是一个二进制文件。
- 链接阶段：程序当中的一些函数，比如printf函数，是保存在printf.o的预编译好的目标文件中，需要将该文件合并到程序中，就要通过链接器。结果得到hello文件，他是一个可执行文件，可以被加载到内存中，由系统执行。

### 系统的硬件组成

#### 1. 总线

贯穿整个系统的电子管道。携带信息字节再各个组件之间传递。通常总线被设计成传送定长的字节块，也叫做字。字的字节数是一个基本的系统参数，各个系统中都不尽相同。

#### 2. I/O设备

每个I/O设备都通过一个控制器或适配器与I/O总线相连。

**控制器与适配器的区别**：封装方式不同。控制器是I/O设备本身或者系统主板的芯片组。适配器是插在主板卡槽上的卡。

#### 3. 主存

主存是一个临时存储设备，在处理器执行程序时，主存存储程序和程序处理的数据。从物理上说，主存时由一组动态随机存取存储器组成。逻辑上讲，存储器是一个线性的字节组，每个字节都有其唯一的地址。

#### 4. 处理器

中央处理器（CPU），简称处理器，是解释或执行存储在主存中指令的引擎。处理器的核心是一个大小为一个字的寄存器，称为程序计数器(PC)。PC总指向主存中的某条机器语言指令。

PC指向主存中的某条机器语言指令，处理器来执行。然后PC更新，指向下一条机器语言指令，不断的进行下去。

CPU在指令的要求下可能会执行这些操作：

- 加载：从主存复制一个字节或者一个字到寄存器，以覆盖寄存器原来的内容。
- 存储：从寄存器复制一个字节或者一个字到主存的某个位置，以覆盖这个位置上原来的内容。
- 操作：把两个寄存器中的内容复制到ALU(算术逻辑单元)，ALU对两个字做算术运算，并将结果存放到一个寄存器中，以覆盖该寄存器原来的内容。
- 跳转：从指令本身中抽取一个字，并将这个字复制到程序计数器中，以覆盖PC中原来的值。![image-20200507153806323](D:\markdown的笔记\Typora\images\image-20200507153806323.png)

### 存储设备

- cache memory：高速缓存寄存器，作为暂时的集结区域，存放处理器近期可能会需要的信息。更小、更快、每字节的造价更高。L1和L2高速缓存是用一种叫做*静态随机访问存储器* 的硬件技术实现的。利用了高速缓存的局部性原理，即程序具有访问局部区域里的数据和代码的趋势。
- 存储设备的层次结构：![image-20200508094748163](D:\markdown的笔记\Typora\images\image-20200508094748163.png)
- 寄存器 -> L1高速缓存 -> L2高速缓存 -> L3高速缓存 -> 主存 -> 本地二级存储 -> 远程二级存储。从上到下，体积越大、访问速度越慢、每字节造价越低。
- 存储器层次结构的主要思想是上一层存储器是低一层存储器的高速缓存。

### 操作系统管理硬件

- 操作系统是软硬件之间的桥梁。既保证了硬件不会被失控的程序滥用，也为程序提供了统一的机制来控制硬件。
- 操作系统通过进程、虚拟内存、文件来实现上面的功能。文件时I/O设备的抽象表示。虚拟内存是主存、磁盘I/O设备的抽象表示。进程是处理器、主存和I/O的抽象表示。![image-20200508120002547](D:\markdown的笔记\Typora\images\image-20200508120002547.png)
  - 进程：
    - 进程是操作系统对一个正在运行的程序的一种抽象。
    - 一个系统可以有多个程序，每个程序都感觉处理器好像只在处理自己一个程序。
    - 并发运行，是指一个进程的指令和另一个进程的指令是交错执行的。处理器并发执行是通过进程之间的切换完成的，也叫做上下文切换。
    - 进程运行时的状态（环境）叫做上下文，包含很多信息，比如PC和寄存器文件的当前值，主存的内容等。
    - 当操作系统进行上下文切换时，保存当前进程的上下文，恢复新进程的上下文，然后将控制权交给新进程。
    - 进程之间的切换是由操作系统内核管理的。内核是操作系统代码常驻主存中的部分。当应用程序需要操作系统的某些操作时，就会执行一条特殊的系统调用指令，将控制权传递给内核，然后内核执行请求的操作并把结果返回给应用程序。内核不是一个独立的进程。
  - 线程：
    - 一个进程是由多个称为线程的执行单元组成。
    - 每个线程都运行在进程的上下文中。线程间可以共享同样的代码和全局数据，相对于进程更高效。
  - 虚拟内存：
    - 虚拟内存让每个进程都产生了一种假象，即每个进程都在独占处理器，看到的空间都一样，叫做虚拟地址空间。
    - ![image-20200508120647721](D:\markdown的笔记\Typora\images\image-20200508120647721.png)图中的地址从下往上增大。每个进程看到的虚拟地址空间都是由大量准确定义的区构成。
      - 程序代码和数据：进程一开始就确定了大小
      - 堆：运行时堆，可以动态调整大小
      - 共享库：放一些共享库的代码和数据
      - 栈：用户栈，也可以动态调整大小，编译器用它来实现函数的调用。调用函数，栈增加，函数返回，栈收缩。
      - 内核虚拟内存：应用程序不可以读写。该区域必须通过内核执行相关操作。
  - 文件：文件就是字节序列。都是通过一小组Unix I/O的系统调用函数来读写文件的。

### 系统之间利用网络通信

### 重要主题

1. Amdahl定律
2. 并发和并行
   1. 线程级并发
   2. 指令集并行
   3. 单指令、多数据并行